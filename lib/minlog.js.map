{"version":3,"sources":["../src/minlog.js"],"names":[],"mappings":";;;;;;;;;AAAA;;AAEA;;;;;;AAIe,MAAM,MAAN,CAAa;AA2B1B,EAAA,WAAW,CAAC;AACV,IAAA,WAAW,GAAG,KAAK,WADT;AAEV,IAAA,SAAS,GAAG,KAAK,SAFP;AAGV,IAAA,MAAM,GAAG;AAHC,MAIR,EAJO,EAIH;AAAA,oCA9BC;AACP;AACA,MAAA,KAAK,EAAE,CAFA;AAEG;AACV,MAAA,OAAO,EAAE,EAHF;AAGM;AACb,MAAA,KAAK,EAAE,EAJA;AAMP;AACA,MAAA,SAAS,EAAE,CAPJ;AAQP,MAAA,KAAK,EAAE,EARA;AASP,MAAA,QAAQ,EAAE,EATH;AAUP,MAAA,KAAK,EAAE,EAVA;AAWP,MAAA,OAAO,EAAE,EAXF;AAYP,MAAA,MAAM,EAAE,EAZD;AAaP,MAAA,aAAa,EAAE,EAbR;AAcP,MAAA,KAAK,EAAE,EAdA;AAgBP;AACA,MAAA,IAAI,EAAE,EAjBC;AAiBG;AACV,MAAA,IAAI,EAAE,EAlBC;AAkBG;AACV,MAAA,KAAK,EAAE;AAnBA,KA8BD;;AAAA,yCARM,EAQN;;AAAA,uCANI,EAMJ;;AACN,SAAK,WAAL,GAAmB,yBAAE,KAAF,CAAQ,WAAR,CAAnB;AACA,SAAK,SAAL,GAAiB,yBAAE,KAAF,CAAQ,SAAR,CAAjB;AACA,SAAK,MAAL,GAAc,yBAAE,KAAF,CAAQ,KAAK,MAAb,EAAqB,MAArB,CAAd;;AAEA,6BAAE,OAAF,CAAU,KAAK,MAAf,EAAuB,CAAC,MAAD,EAAS,SAAT,KAAuB;AAC5C,WAAK,SAAL,IAAkB,yBAAE,IAAF,CAAO,KAAK,GAAZ,EAAiB,IAAjB,EAAuB,SAAvB,CAAlB;AACD,KAFD;AAGD;;AAED,EAAA,gBAAgB,CAAC,KAAD,EAAQ;AACtB,QAAI,yBAAE,QAAF,CAAW,KAAX,CAAJ,EAAuB;AACrB;AACA,MAAA,KAAK,GAAG,KAAK,MAAL,CAAY,KAAZ,CAAR;;AAEA,UAAI,yBAAE,WAAF,CAAc,KAAd,CAAJ,EAA0B;AACxB,cAAM,IAAI,KAAJ,CAAW,sBAAqB,KAAM,YAAW,yBAAE,IAAF,CAAO,KAAK,MAAZ,CAAoB,GAArE,CAAN;AACD;AACF;;AAED,QAAI,SAAS,GAAG,yBAAE,MAAF,CAAS,KAAK,MAAd,EAAsB,KAAtB,KAAiC,MAAK,KAAM,EAA5D;AACA,WAAO,SAAP;AACD;;AAEK,EAAA,GAAN,CAAU,KAAV,EAAiB,GAAG,IAApB,EAA0B;AAAA;;AAAA;AACxB,UAAI,yBAAE,QAAF,CAAW,KAAX,CAAJ,EAAuB;AACrB;AACA,QAAA,KAAK,GAAG,KAAI,CAAC,MAAL,CAAY,KAAZ,CAAR;AACD;;AAED,UAAI,GAAG,GAAG,yBAAc,CAAd,CAAV;AAEA,UAAI,KAAK,GAAG;AACV,QAAA,KAAK,EAAE,IAAI,IAAJ,EADG;AAEV,QAAA,MAAM,EAAE,KAFE;AAGV,QAAA,IAAI,EAAE;AAHI,OAAZ;;AAMA,+BAAE,OAAF,CAAU,IAAV,EAAgB,UAAS,GAAT,EAAc,KAAd,EAAqB;AACnC,YAAI,UAAU,GAAG;AACf,WAAE,OAAM,KAAM,EAAd,GAAkB;AADH,SAAjB;;AAIA,YAAI,yBAAE,OAAF,CAAU,GAAV,KAAkB,yBAAE,WAAF,CAAc,KAAK,CAAC,GAApB,CAAtB,EAAgD;AAC9C,UAAA,UAAU,CAAC,GAAX,GAAiB,GAAjB;AACD,SAFD,MAEO,IAAI,yBAAE,QAAF,CAAW,GAAX,KAAmB,yBAAE,WAAF,CAAc,KAAK,CAAC,GAApB,CAAvB,EAAiD;AACtD,UAAA,UAAU,CAAC,GAAX,GAAiB,GAAjB;AACD,SAFM,MAEA,IAAI,yBAAE,aAAF,CAAgB,GAAhB,CAAJ,EAA0B;AAC/B,mCAAE,QAAF,CAAW,UAAX,EAAuB,GAAvB;AACD;;AAED,iCAAE,KAAF,CAAQ,KAAR,EAAe,UAAf;AACD,OAdD;;AAgBA,UAAI,QAAQ,GAAG,yBAAE,SAAF,CAAY,KAAZ,CAAf;;AACA,MAAA,QAAQ,CAAC,KAAT,GAAiB,IAAjB,CA/BwB,CAiCxB;;AACA,MAAA,KAAK,SAAS,yBAAE,MAAF,CAAS,KAAI,CAAC,WAAd;AAAA;AAAA;AAAA,4CAA2B,WAAO,YAAP,EAAqB,UAArB,EAAoC;AAC3E,cAAI,KAAK,SAAS,YAAlB;AACA,UAAA,KAAK,SAAS,UAAU,CAAC;AAAC,YAAA,KAAD;AAAQ,YAAA,MAAM,EAAE,KAAhB;AAAsB,YAAA;AAAtB,WAAD,CAAxB;AACA,iBAAO,OAAO,CAAC,OAAR,CAAgB,KAAhB,CAAP;AACD,SAJa;;AAAA;AAAA;AAAA;AAAA,WAIX,OAAO,CAAC,OAAR,CAAgB,KAAhB,CAJW,CAAd;;AAMA,+BAAE,OAAF,CAAU,KAAI,CAAC,SAAf,EAA2B,QAAD,IAAc;AACtC,QAAA,QAAQ,CAAC;AAAC,UAAA,KAAD;AAAQ,UAAA,MAAM,EAAE,KAAhB;AAAsB,UAAA;AAAtB,SAAD,CAAR;AACD,OAFD;AAxCwB;AA2CzB;;AAlGyB","file":"minlog.js","sourcesContent":["import _ from 'lodash-firecloud';\n\nimport {\n  getCallerInfo\n} from './util';\n\nexport default class MinLog {\n  levels = {\n    // npm alias\n    fatal: 0, // emergency\n    verbose: 70, // debug\n    silly: 80,\n\n    // https://tools.ietf.org/html/rfc3164 (multiplier 10)\n    emergency: 0,\n    alert: 10,\n    critical: 20,\n    error: 30,\n    warning: 40,\n    notice: 50,\n    informational: 60,\n    debug: 70,\n\n    // console\n    warn: 40, // warning\n    info: 60, // informational\n    trace: 90\n  };\n\n  serializers = [];\n\n  listeners = [];\n\n  constructor({\n    serializers = this.serializers,\n    listeners = this.listeners,\n    levels = {}\n  } = {}) {\n    this.serializers = _.clone(serializers);\n    this.listeners = _.clone(listeners);\n    this.levels = _.merge(this.levels, levels);\n\n    _.forEach(this.levels, (_level, levelName) => {\n      this[levelName] = _.bind(this.log, this, levelName);\n    });\n  }\n\n  levelToLevelName(level) {\n    if (_.isString(level)) {\n      // eslint-disable-next-line prefer-destructuring\n      level = this.levels[level];\n\n      if (_.isUndefined(level)) {\n        throw new Error(`Unknown level name ${level}. Known: ${_.keys(this.levels)}.`);\n      }\n    }\n\n    let levelName = _.invert(this.levels)[level] || `lvl${level}`;\n    return levelName;\n  }\n\n  async log(level, ...args) {\n    if (_.isString(level)) {\n      // eslint-disable-next-line prefer-destructuring\n      level = this.levels[level];\n    }\n\n    let src = getCallerInfo(5);\n\n    let entry = {\n      _time: new Date(),\n      _level: level,\n      _src: src\n    };\n\n    _.forEach(args, function(arg, index) {\n      let amendEntry = {\n        [`_arg${index}`]: arg\n      };\n\n      if (_.isError(arg) && _.isUndefined(entry.msg)) {\n        amendEntry.err = arg;\n      } else if (_.isString(arg) && _.isUndefined(entry.msg)) {\n        amendEntry.msg = arg;\n      } else if (_.isPlainObject(arg)) {\n        _.defaults(amendEntry, arg);\n      }\n\n      _.merge(entry, amendEntry);\n    });\n\n    let rawEntry = _.cloneDeep(entry);\n    rawEntry._args = args;\n\n    // eslint-disable-next-line require-atomic-updates\n    entry = await _.reduce(this.serializers, async (entryPromise, serializer) => {\n      let entry = await entryPromise;\n      entry = await serializer({entry, logger: this, rawEntry});\n      return Promise.resolve(entry);\n    }, Promise.resolve(entry));\n\n    _.forEach(this.listeners, (listener) => {\n      listener({entry, logger: this, rawEntry});\n    });\n  }\n}\n"]}