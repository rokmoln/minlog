{"version":3,"sources":["../../src/listeners/log-to-console.js"],"names":[],"mappings":"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","file":"log-to-console.js","sourcesContent":["import _ from 'lodash';\nimport moment from 'moment';\n\nexport let _levelToConsoleFun = function({level, levels}) {\n  if (_.isString(level)) {\n    // eslint-disable-next-line prefer-destructuring\n    level = levels[level];\n  }\n\n  if (_.inRange(level, 0, levels.warn)) {\n    return 'error';\n  } else if (_.inRange(level, levels.warn, levels.info)) {\n    return 'warn';\n  } else if (_.inRange(level, levels.info, levels.debug)) {\n    return 'info';\n  } else if (_.inRange(level, levels.debug, levels.trace)) {\n    // return 'debug';\n    // console.debug doesn't seem to print anything,\n    // but console.debug is an alias to console.log anyway\n    return 'log';\n  } else if (level === levels.trace) {\n    return 'trace';\n  }\n\n  return 'log';\n};\n\n/*\ncfg has 2 properties\n- level (optional, defaults to trace)\n  Any log entry less important that cfg.level is ignore.\n- iframeId (optional, default to 'top' or '?'\n  An identifier for the current \"window\".\n*/\n\nexport default function(cfg = {}) {\n  return async function({entry, logger, rawEntry}) {\n    if (_.filter(rawEntry._args).length === 1 && rawEntry._args[0]._babelSrc) {\n      return;\n    }\n\n    let maxLevelName = cfg.level || 'trace';\n    let maxLevel = logger.levels[maxLevelName];\n    maxLevel = _.floor(maxLevel / 10) * 10 + 10 - 1; // round up to next level, not inclusive\n    if (entry.level > maxLevel) {\n      return;\n    }\n\n    let now = moment(entry._time.stamp).utcOffset(entry._time.utc_offset).toISOString();\n    let levelName = logger.levelToLevelName(entry._level);\n    let formattedLevelName = _.padStart(_.toUpper(levelName), '5');\n    let consoleFun = exports._levelToConsoleFun({\n      level: entry._level,\n      levels: logger.levels\n    });\n\n    let color = '';\n    switch (consoleFun) {\n    case 'log':\n    case 'info':\n    case 'trace':\n      color = 'color: dodgerblue';\n      break;\n    default:\n    }\n\n    let prefixFormat = '%c%s %c%s%c';\n    let prefixArgs = [\n      color,\n      now,\n      'font-weight: bold',\n      formattedLevelName,\n      color\n    ];\n\n    let src = '';\n    if (entry._babelSrc) {\n      src = _.merge({}, entry._src, entry._babelSrc);\n      src = ` @webpack:///./${src.file}:${src.line}:${src.column}${src.function ? ` in ${src.function}()` : ''}`;\n    } else if (entry._src) {\n      src = entry._src;\n      src = ` ${src.file}:${src.line}:${src.column}${src.function ? ` in ${src.function}()` : ''}`;\n    }\n\n    let iframeId = _.defaultTo(\n      cfg.iframeId,\n      window.parent === window ? 'top' : '?'\n    );\n\n    let context = {\n      window,\n      documentElement: window.document.documentElement\n    };\n\n    let srcFormat = '%s in the %s context';\n    let srcArgs = [\n      src,\n      iframeId\n    ];\n\n    let msgFormat = '';\n    let msgArgs = [];\n    if (entry.msg) {\n      msgFormat = '\\n%s';\n      msgArgs = [\n        entry.msg\n      ];\n    }\n\n    let extraFormat = '';\n    let extraArgs = [];\n\n    let extra = _.omit(rawEntry, [\n      '_args',\n      '_babelSrc',\n      '_level',\n      '_src',\n      '_time',\n      'iframeId',\n      'msg'\n    ]);\n    _.merge(extra, context);\n\n    // devTools console sorts keys when object is expanded\n    extra = _.toPairs(extra);\n    extra = _.sortBy(extra, 0);\n    extra = _.fromPairs(extra);\n\n    // devTools collapses objects with 'too many' keys,\n    // so we output objects with only one key\n    _.forEach(extra, function(value, key) {\n      extraArgs.push('\\n');\n      extraArgs.push({[key]: value});\n    });\n\n    // eslint-disable-next-line no-console\n    console[consoleFun](\n      `${prefixFormat}${srcFormat}:${msgFormat}${extraFormat}`,\n      ...prefixArgs,\n      ...srcArgs,\n      ...msgArgs,\n      ...extraArgs\n    );\n  };\n}\n"]}