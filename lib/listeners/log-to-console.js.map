{"version":3,"sources":["../../src/listeners/log-to-console.js"],"names":[],"mappings":"0OAAA;AACA;AACA,wD;;AAEA,IAAI,UAAU,GAAG,OAAO,MAAP,KAAkB,WAAnC,C;AACA,IAAI,OAAO,GAAG,OAAO,OAAP,KAAmB,WAAnB,IAAkC,CAAC,yBAAE,WAAF,CAAc,yBAAE,GAAF,CAAM,OAAN,EAAe,eAAf,CAAd,CAAjD,C;;AAEA,IAAI,kBAAkB,GAAG,UAAS,EAAC,KAAD,EAAQ,MAAR,EAAT,EAA0B;AACjD,MAAI,yBAAE,QAAF,CAAW,KAAX,CAAJ,EAAuB;AACrB;AACA,IAAA,KAAK,GAAG,MAAM,CAAC,KAAD,CAAd;AACD;;AAED,MAAI,yBAAE,OAAF,CAAU,KAAV,EAAiB,CAAjB,EAAoB,MAAM,CAAC,IAA3B,CAAJ,EAAsC;AACpC,WAAO,OAAP;AACD,GAFD,MAEO,IAAI,yBAAE,OAAF,CAAU,KAAV,EAAiB,MAAM,CAAC,IAAxB,EAA8B,MAAM,CAAC,IAArC,CAAJ,EAAgD;AACrD,WAAO,MAAP;AACD,GAFM,MAEA,IAAI,yBAAE,OAAF,CAAU,KAAV,EAAiB,MAAM,CAAC,IAAxB,EAA8B,MAAM,CAAC,KAArC,CAAJ,EAAiD;AACtD,WAAO,MAAP;AACD,GAFM,MAEA,IAAI,yBAAE,OAAF,CAAU,KAAV,EAAiB,MAAM,CAAC,KAAxB,EAA+B,MAAM,CAAC,KAAtC,CAAJ,EAAkD;AACvD;AACA;AACA;AACA,WAAO,KAAP;AACD,GALM,MAKA,IAAI,KAAK,KAAK,MAAM,CAAC,KAArB,EAA4B;AACjC,WAAO,OAAP;AACD;;AAED,SAAO,KAAP;AACD,CAtBD;;AAwBA;;;;;;;;AAQO,IAAI,SAAS,GAAG,UAAS,EAAC,KAAD,EAAQ,MAAR,EAAgB,SAAhB,EAA2B,GAA3B,EAAT,EAA0C;AAC/D,MAAI,SAAJ;AACA,MAAI,aAAa,GAAG,KAApB;;AAEA,0BAAgB;AACd,QAAI,MAAM,CAAC,MAAP,KAAkB,MAAtB,EAA8B;AAC5B,MAAA,SAAS,GAAG,KAAZ;AACD;AACD,IAAA,aAAa,GAAG,IAAhB;AACD;;AAED,EAAA,GAAG,GAAG,yBAAE,QAAF,CAAW,EAAX,EAAe,GAAf,EAAoB;AACxB,IAAA,SADwB;AAExB,IAAA,KAAK,EAAE,OAFiB,EAApB,CAAN;;;AAKA,MAAI,GAAG,GAAG,qBAAO,KAAK,CAAC,KAAN,CAAY,KAAnB,EAA0B,SAA1B,CAAoC,KAAK,CAAC,KAAN,CAAY,UAAhD,EAA4D,WAA5D,EAAV;AACA,MAAI,SAAS,GAAG,MAAM,CAAC,gBAAP,CAAwB,KAAK,CAAC,MAA9B,CAAhB;AACA,MAAI,kBAAkB,GAAG,yBAAE,QAAF,CAAW,yBAAE,OAAF,CAAU,SAAV,CAAX,EAAiC,GAAjC,CAAzB;AACA,MAAI,UAAU,GAAG,2BAAmB;AAClC,IAAA,KAAK,EAAE,KAAK,CAAC,MADqB;AAElC,IAAA,MAAM,EAAE,MAAM,CAAC,MAFmB,EAAnB,CAAjB;;;AAKA,MAAI,KAAK,GAAG,EAAZ;AACA,UAAQ,UAAR;AACA,SAAK,KAAL;AACA,SAAK,MAAL;AACA,SAAK,OAAL;AACE,MAAA,KAAK,GAAG,mBAAR;AACA;AACF,YANA;;;AASA,MAAI,GAAG,GAAG,EAAV;AACA,MAAI,KAAK,CAAC,SAAV,EAAqB;AACnB,IAAA,GAAG,GAAG,yBAAE,KAAF,CAAQ,EAAR,EAAY,KAAK,CAAC,IAAlB,EAAwB,KAAK,CAAC,SAA9B,CAAN;AACA,IAAA,GAAG,GAAI,iBAAgB,GAAG,CAAC,IAAK,IAAG,GAAG,CAAC,IAAK,IAAG,GAAG,CAAC,MAAO,GAAE,GAAG,CAAC,QAAJ,GAAgB,OAAM,GAAG,CAAC,QAAS,IAAnC,GAAyC,EAAG,EAAxG;AACD,GAHD,MAGO,IAAI,KAAK,CAAC,IAAV,EAAgB;AACrB,IAAA,GAAG,GAAG,KAAK,CAAC,IAAZ;AACA,IAAA,GAAG,GAAI,GAAE,GAAG,CAAC,IAAK,IAAG,GAAG,CAAC,IAAK,IAAG,GAAG,CAAC,MAAO,GAAE,GAAG,CAAC,QAAJ,GAAgB,OAAM,GAAG,CAAC,QAAS,IAAnC,GAAyC,EAAG,EAA1F;AACD;;AAED,MAAI,GAAG,GAAG,KAAK,CAAC,GAAN,IAAa,EAAvB;AACA,MAAI,GAAJ,EAAS;AACP,QAAI;AACF,MAAA,SAAS,EAAE,QADT;AAEA,IAAA,KAFJ;;AAIA,QAAI,QAAJ,EAAc;AACZ,MAAA,GAAG,GAAI,GAAE,GAAI,WAAU,QAAQ,CAAC,EAAG,KAAnC;AACA,UAAI,QAAQ,CAAC,EAAT,GAAc,IAAlB,EAAwB;AACtB,QAAA,GAAG,GAAI,GAAE,GAAI,KAAI,QAAQ,CAAC,KAAM,GAAhC;AACD;AACF;AACF;;AAED,MAAI,KAAK,GAAG,yBAAE,IAAF,CAAO,KAAP,EAAc;AACxB,SADwB;AAExB,aAFwB;AAGxB,aAHwB;AAIxB,UAJwB;AAKxB,QALwB;AAMxB,SANwB;AAOxB,YAPwB;AAQxB,cARwB;AASxB,OATwB,CAAd,CAAZ;;AAWA,EAAA,KAAK,GAAG,yBAAE,MAAF,CAAS,KAAT,EAAgB,UAAS,MAAT,EAAiB,GAAjB,EAAsB;AAC5C,WAAO,eAAe,IAAf,CAAoB,GAApB,CAAP;AACD,GAFO,CAAR;;AAIA,0BAAgB;AACd,QAAI,GAAG,GAAG;AACR,MAAA,MADQ;AAER,MAAA,eAAe,EAAE,MAAM,CAAC,QAAP,CAAgB,eAFzB,EAAV;;AAIA,6BAAE,KAAF,CAAQ,KAAR,EAAe;AACb,MAAA,GADa,EAAf;;AAGD;;AAED;AACA,EAAA,KAAK,GAAG,yBAAE,OAAF,CAAU,KAAV,CAAR;AACA,EAAA,KAAK,GAAG,yBAAE,MAAF,CAAS,KAAT,EAAgB,CAAhB,CAAR;AACA,EAAA,KAAK,GAAG,yBAAE,SAAF,CAAY,KAAZ,CAAR;;AAEA,SAAO;AACL,IAAA,GADK;AAEL,IAAA,aAFK;;AAIL,IAAA,GAJK;AAKL,IAAA,SALK;AAML,IAAA,kBANK;AAOL,IAAA,UAPK;AAQL,IAAA,KARK;AASL,IAAA,GATK;AAUL,IAAA,GAVK;;AAYL,IAAA,KAZK,EAAP;;AAcD,CArGM,C;;AAuGA,IAAI,YAAY,GAAG,UAAS,GAAG,IAAZ,EAAkB;AAC1C,MAAI;AACF,IAAA,MADE;AAEF,IAAA,UAFE;AAGA,2BAAE,MAAF,CAAS,IAAT,EAAe,UAAS,MAAT,EAAiB,GAAjB,EAAsB;AACvC,QAAI;AACF,MAAA,MADE;AAEF,MAAA,UAFE;AAGA,IAAA,MAHJ;;AAKA,QAAI,yBAAE,QAAF,CAAW,GAAX,CAAJ,EAAqB;AACnB,MAAA,MAAM,CAAC,IAAP,CAAY,GAAZ;AACA,aAAO;AACL,QAAA,MADK;AAEL,QAAA,UAFK,EAAP;;AAID;;AAED,IAAA,MAAM,CAAC,IAAP,CAAY,GAAG,CAAC,CAAD,CAAf;AACA,IAAA,UAAU,CAAC,IAAX,CAAgB,GAAG,CAAC,CAAD,CAAnB;;AAEA,WAAO;AACL,MAAA,MADK;AAEL,MAAA,UAFK,EAAP;;AAID,GArBG,EAqBD;AACD,IAAA,MAAM,EAAE,EADP;AAED,IAAA,UAAU,EAAE,EAFX,EArBC,CAHJ;;;AA6BA,EAAA,MAAM,GAAG,yBAAE,IAAF,CAAO,MAAP,EAAe,EAAf,CAAT;AACA,EAAA,UAAU,CAAC,OAAX,CAAmB,MAAnB;AACA,SAAO,UAAP;AACD,CAjCM,C;;AAmCA,IAAI,YAAY,GAAG,UAAS,GAAG,GAAG,EAAf,EAAmB;AAC3C;AACA,SAAO,gBAAe,EAAC,KAAD,EAAQ,MAAR,EAAgB,QAAhB,EAAf,EAA0C;AAC/C,QAAI,yBAAE,MAAF,CAAS,QAAQ,CAAC,KAAlB,EAAyB,MAAzB,KAAoC,CAApC,IAAyC,QAAQ,CAAC,KAAT,CAAe,CAAf,EAAkB,SAA/D,EAA0E;AACxE;AACD;;AAED,QAAI,MAAM,CAAC,kBAAP,CAA0B,KAAK,CAAC,MAAhC,EAAwC,GAAG,CAAC,KAA5C,CAAJ,EAAwD;AACtD;AACD;;AAED,QAAI;AACF,MAAA,GAAG,EAAE,IADH;AAEF,MAAA,aAFE;AAGF,MAAA,GAHE;AAIF,MAAA,kBAJE;AAKF,MAAA,UALE;AAMF,MAAA,KANE;AAOF,MAAA,GAPE;AAQF,MAAA,GARE;AASF,MAAA,KATE;AAUA,sBAAU,EAAC,KAAD,EAAQ,MAAR,EAAgB,QAAhB,EAA0B,GAA1B,EAAV,CAVJ;AAWA,IAAA,GAAG,GAAG,IAAN;;AAEA,QAAI,SAAS,GAAG,EAAhB;AACA;AACA;AACA,6BAAE,OAAF,CAAU,KAAV,EAAiB,UAAS,KAAT,EAAgB,GAAhB,EAAqB;AACpC,UAAI,yBAAE,WAAF,CAAc,KAAd,CAAJ,EAA0B;AACxB;AACD;;AAED,MAAA,KAAK,GAAG;AACN,SAAC,GAAD,GAAO,KADD,EAAR;;;AAIA,8BAAgB;AACd,QAAA,SAAS,CAAC,IAAV,CAAe,IAAf;AACA,QAAA,SAAS,CAAC,IAAV,CAAe,KAAf;AACD,OAHD,MAGO,qBAAa;AAClB;AACA,QAAA,KAAK,GAAG,gCAAkB,KAAlB,EAAyB,SAAzB,EAAoC,CAApC,CAAR;AACA,QAAA,KAAK,GAAI,KAAI,KAAM,EAAnB;AACA,QAAA,SAAS,CAAC,IAAV,CAAe,KAAf;AACD;AACF,KAlBD;;AAoBA,QAAI,UAAU,GAAG,EAAjB;;AAEA;AACA,QAAI,aAAJ,EAAmB;AACjB,MAAA,UAAU,CAAC,IAAX,CAAgB;AACd,UADc;AAEd,MAAA,KAFc,CAAhB;;AAID;;AAED;AACA,IAAA,UAAU,CAAC,IAAX,CAAgB;AACd,QADc;AAEd,IAAA,GAFc,CAAhB;;;AAKA;AACA,QAAI,CAAC,yBAAE,WAAF,CAAc,GAAG,CAAC,SAAlB,CAAL,EAAmC;AACjC,MAAA,UAAU,CAAC,IAAX,CAAgB;AACd,WADc;AAEd,MAAA,GAAG,CAAC,SAFU,CAAhB;;AAID;;AAED;AACA,QAAI,aAAJ,EAAmB;AACjB,MAAA,UAAU,CAAC,IAAX,CAAgB;AACd,UADc;AAEd,yBAFc,CAAhB;;AAID;AACD,IAAA,UAAU,CAAC,IAAX,CAAgB;AACd,SADc;AAEd,IAAA,kBAFc,CAAhB;;;AAKA;AACA,QAAI,aAAJ,EAAmB;AACjB,MAAA,UAAU,CAAC,IAAX,CAAgB;AACd,UADc;AAEd,MAAA,KAFc,CAAhB;;AAID;;AAED;AACA,QAAI,GAAJ,EAAS;AACP,MAAA,UAAU,CAAC,IAAX,CAAgB;AACd,UADc;AAEd,MAAA,GAFc,CAAhB;;AAID;;AAED;AACA,IAAA,UAAU,CAAC,IAAX,CAAgB;AACd,UADc;AAEd,IAAA,GAFc,CAAhB;;;AAKA,IAAA,UAAU,GAAG,qBAAa,GAAG,UAAhB,CAAb;AACA,IAAA,UAAU,GAAG,yBAAE,MAAF,CAAS,UAAT,EAAqB,SAArB,CAAb;;AAEA;AACA,IAAA,OAAO,CAAC,UAAD,CAAP,CAAoB,GAAG,UAAvB;AACD,GA5GD;AA6GD,CA/GM,C","file":"log-to-console.js","sourcesContent":["import _ from 'lodash-firecloud';\nimport fastSafeStringify from 'fast-safe-stringify';\nimport moment from 'moment';\n\nlet _isBrowser = typeof window !== 'undefined';\nlet _isNode = typeof process !== 'undefined' && !_.isUndefined(_.get(process, 'versions.node'));\n\nlet _levelToConsoleFun = function({level, levels}) {\n  if (_.isString(level)) {\n    // eslint-disable-next-line prefer-destructuring\n    level = levels[level];\n  }\n\n  if (_.inRange(level, 0, levels.warn)) {\n    return 'error';\n  } else if (_.inRange(level, levels.warn, levels.info)) {\n    return 'warn';\n  } else if (_.inRange(level, levels.info, levels.debug)) {\n    return 'info';\n  } else if (_.inRange(level, levels.debug, levels.trace)) {\n    // return 'debug';\n    // console.debug doesn't seem to print anything,\n    // but console.debug is an alias to console.log anyway\n    return 'log';\n  } else if (level === levels.trace) {\n    return 'trace';\n  }\n\n  return 'log';\n};\n\n/*\ncfg has 2 properties\n- contextId (optional, default to 'top' in browser and undefined elsewhere)\n  An identifier for the current \"context\".\n- level (optional, defaults to trace)\n  Any log entry less important that cfg.level is ignored.\n*/\n\nexport let serialize = function({entry, logger, _rawEntry, cfg}) {\n  let contextId;\n  let hasCssSupport = false;\n\n  if (_isBrowser) {\n    if (window.parent === window) {\n      contextId = 'top';\n    }\n    hasCssSupport = true;\n  }\n\n  cfg = _.defaults({}, cfg, {\n    contextId,\n    level: 'trace'\n  });\n\n  let now = moment(entry._time.stamp).utcOffset(entry._time.utc_offset).toISOString();\n  let levelName = logger.levelToLevelName(entry._level);\n  let formattedLevelName = _.padStart(_.toUpper(levelName), '5');\n  let consoleFun = _levelToConsoleFun({\n    level: entry._level,\n    levels: logger.levels\n  });\n\n  let color = '';\n  switch (consoleFun) {\n  case 'log':\n  case 'info':\n  case 'trace':\n    color = 'color: dodgerblue';\n    break;\n  default:\n  }\n\n  let src = '';\n  if (entry._babelSrc) {\n    src = _.merge({}, entry._src, entry._babelSrc);\n    src = `@webpack:///./${src.file}:${src.line}:${src.column}${src.function ? ` in ${src.function}()` : ''}`;\n  } else if (entry._src) {\n    src = entry._src;\n    src = `${src.file}:${src.line}:${src.column}${src.function ? ` in ${src.function}()` : ''}`;\n  }\n\n  let msg = entry.msg || '';\n  if (msg) {\n    let {\n      _duration: duration\n    } = entry;\n\n    if (duration) {\n      msg = `${msg} - took ${duration.ms} ms`;\n      if (duration.ms > 1000) {\n        msg = `${msg} (${duration.human})`;\n      }\n    }\n  }\n\n  let extra = _.omit(entry, [\n    '_args',\n    '_babelSrc',\n    '_duration',\n    '_level',\n    '_src',\n    '_time',\n    '_timeEnd',\n    '_timeStart',\n    'msg'\n  ]);\n  extra = _.omitBy(extra, function(_value, key) {\n    return /^_arg[0-9+]$/.test(key);\n  });\n\n  if (_isBrowser) {\n    let ctx = {\n      window,\n      documentElement: window.document.documentElement\n    };\n    _.merge(extra, {\n      ctx\n    });\n  }\n\n  // devTools console sorts keys when object is expanded\n  extra = _.toPairs(extra);\n  extra = _.sortBy(extra, 0);\n  extra = _.fromPairs(extra);\n\n  return {\n    cfg,\n    hasCssSupport,\n\n    now,\n    levelName,\n    formattedLevelName,\n    consoleFun,\n    color,\n    src,\n    msg,\n\n    extra\n  };\n};\n\nexport let toFormatArgs = function(...args) {\n  let {\n    format,\n    formatArgs\n  } = _.reduce(args, function(result, arg) {\n    let {\n      format,\n      formatArgs\n    } = result;\n\n    if (_.isString(arg)) {\n      format.push(arg);\n      return {\n        format,\n        formatArgs\n      };\n    }\n\n    format.push(arg[0]);\n    formatArgs.push(arg[1]);\n\n    return {\n      format,\n      formatArgs\n    };\n  }, {\n    format: [],\n    formatArgs: []\n  });\n\n  format = _.join(format, '');\n  formatArgs.unshift(format);\n  return formatArgs;\n};\n\nexport let logToConsole = function(cfg = {}) {\n  // eslint-disable-next-line complexity\n  return async function({entry, logger, rawEntry}) {\n    if (_.filter(rawEntry._args).length === 1 && rawEntry._args[0]._babelSrc) {\n      return;\n    }\n\n    if (logger.levelIsBeyondGroup(entry._level, cfg.level)) {\n      return;\n    }\n\n    let {\n      cfg: cfg2,\n      hasCssSupport,\n      now,\n      formattedLevelName,\n      consoleFun,\n      color,\n      src,\n      msg,\n      extra\n    } = serialize({entry, logger, rawEntry, cfg});\n    cfg = cfg2;\n\n    let extraArgs = [];\n    // devTools collapses objects with 'too many' keys,\n    // so we output objects with only one key\n    _.forEach(extra, function(value, key) {\n      if (_.isUndefined(value)) {\n        return;\n      }\n\n      value = {\n        [key]: value\n      };\n\n      if (_isBrowser) {\n        extraArgs.push('\\n');\n        extraArgs.push(value);\n      } else if (_isNode) {\n        // prefer JSON output over util.inspect output\n        value = fastSafeStringify(value, undefined, 2);\n        value = `\\n${value}`;\n        extraArgs.push(value);\n      }\n    });\n\n    let formatArgs = [];\n\n    // color\n    if (hasCssSupport) {\n      formatArgs.push([\n        '%c',\n        color\n      ]);\n    }\n\n    // timestamp\n    formatArgs.push([\n      '%s',\n      now\n    ]);\n\n    // context\n    if (!_.isUndefined(cfg.contextId)) {\n      formatArgs.push([\n        ' %s',\n        cfg.contextId\n      ]);\n    }\n\n    // level name\n    if (hasCssSupport) {\n      formatArgs.push([\n        '%c',\n        'font-weight: bold'\n      ]);\n    }\n    formatArgs.push([\n      ' %s',\n      formattedLevelName\n    ]);\n\n    // color\n    if (hasCssSupport) {\n      formatArgs.push([\n        '%c',\n        color\n      ]);\n    }\n\n    // src\n    if (src) {\n      formatArgs.push([\n        '%s',\n        src\n      ]);\n    }\n\n    // msg\n    formatArgs.push([\n      '\\n%s',\n      msg\n    ]);\n\n    formatArgs = toFormatArgs(...formatArgs);\n    formatArgs = _.concat(formatArgs, extraArgs);\n\n    // eslint-disable-next-line no-console\n    console[consoleFun](...formatArgs);\n  };\n};\n\nexport default logToConsole;\n"]}